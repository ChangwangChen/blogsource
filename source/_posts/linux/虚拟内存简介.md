---
title: 虚拟内存简介
date: 2020-07-09 16:50:45
categories: Linux
tags: [Linux]
---

# #内容概要
虚拟内存是操作系统的重要特性， 操作系统为每个进程都提供了相同大小的虚拟内存地址空间。关于虚拟内存有一下几点：

* 进程的虚拟内存是在 `磁盘` 上开辟的连续的空间
* 每个进程的虚拟内存空间都是独立的，互不干扰
* 虚拟内存地址通过 `MMU` 映射到物理内存地址

# ## 虚拟地址转换过程

我们可以将虚拟内存看作是在磁盘上一片空间，当这片空间中的一部分访问比较频繁时，该部分数据会以页为单位被缓存到主存中以加速 CPU 访问数据的性能，虚拟内存利用空间较大的磁盘存储作为『内存』并使用主存储缓存进行加速，让上层认为操作系统的内存很大而且很快，然而区域很大的磁盘并不快，而很快的内存也并不大。

虚拟内存中的虚拟页（Virtual Page，PP）可能处于以下的三种状态 — `未分配（Unallocated）`、`未缓存（Uncached）`和`已缓存（Cached）`，其中未分配的内存页是没有被进程申请使用的，也就是空闲的虚拟内存，不占用虚拟内存磁盘的任何空间，未缓存和已缓存的内存页分别表示仅加载到磁盘中的内存页和已经加载到主存中的内存页。如上图所示，图中绿色的虚拟内存页由主存中的物理内存页（Physical Page，PP）支撑，所以它是已经缓存过的，而黄色的虚拟内存页仅在磁盘中，所以没有被物理内存缓存。

当用户程序访问未被缓存的虚拟页时，硬件就会触发`缺页中断（Page Fault，PF）`，在部分情况下，被访问的页面已经加载到了物理内存中，但是用户程序的页表（Page Table）并不存在该对应关系，这时我们只需要在页表中建立虚拟内存到物理内存的关系；在其他情况下，操作系统需要将磁盘上未被缓存的虚拟页加载到物理内存中。

因为主内存的空间是有限的，当主内存中不包含可以使用的空间时，操作系统会从选择合适的物理内存页驱逐回磁盘，为新的内存页让出位置，`选择待驱逐页的过程在操作系统中叫做页面替换（Page Replacement）`。缺页中断和页面替换技术都是操作系统调页算法（Paging）的一部分，该算法的目的就是充分利用内存资源作为磁盘的缓存以提高程序的运行效率。

# #说明
本篇文章摘抄自 [为什么 Linux 需要虚拟内存](https://draveness.me/whys-the-design-os-virtual-memory)
